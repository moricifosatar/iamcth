---
title: "Исследование метаданных DNS трафика"
output: html_document
date: "2022-11-02"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Цель работы
1. Зекрепить практические навыки использования языка программирования R для обработки данных

2. Закрепить знания основных функций обработки данных экосистемы tidyverse языка R

3. Закрепить навыки исследования метаданных DNS трафика

## Задание
### Подготовка данных
```{r}
library(dplyr)
```

#### 1. Импортируйте данные DNS
#### 2. Добавьте пропущенные данные о структуре данных (назначении столбцов)
#### 3. Преобразуйте данные в столбцах в нужный формат
```{r}

head=read.csv("header.csv", header = TRUE)
field<-head[,1]
data = read.csv("dns.log", header = FALSE,sep = "\t",encoding = "UTF-8")
names(data)<-field
print(data)
```
### Анализ 
#### 4.Сколько участников информационного обмена в сети Доброй Организации?
```{r}
Is<-(unique(data$is))
Id<-(unique(data$id))
print(length(unique(union(Is,Id))))
```

#### 5.Какое соотношение участников обмена внутри сети и участников обращений к внешним ресурсам?
```{r}
match(Is,Id)
```

#### 6.Найдите топ-10 участников сети, проявляющих наибольшую сетевую активность.

```{r}
library(dplyr)
v<- rev(sort(table(data$query)))
slice(as.data.frame(v),1:10)

```


#### 7.Найдите топ-10 доменов, к которым обращаются пользователи сети и соответственное количество обращений
```{r}
df<-data%>%
count(data$`query `,sort=TRUE)
dfhead<-df%>%
head(10)
dfhead
```

#### 8. Опеределите базовые статистические характеристики (функция summary()) интервала времени между последовательным обращениями к топ-10 доменам.
```{r}
library(dplyr)
data %>%
  mutate(countdom=1) %>%
  group_by(query)%>%
  summarise(countdown = sum(countdown),ts=ts)%>%
  arrange(desc(countdown))

```

#### 9. Часто вредоносное программное обеспечение использует DNS канал в качестве канала управления, периодически отправляя запросы на подконтрольный злоумышленникам DNS сервер. По периодическимзапросам на один и тот же домен можно выявить скрытый DNS канал. Есть ли такие IP адреса в исследуемом датасете?
```{r}
filter(data, query=="teredo.ipv6.microsoft.com")%>%
  select(ts)%>%
  summary()
```

### Обогащение данных

#### 10. Определите местоположение (страну, город) и организацию-провайдера для топ-10 доменов. Для этогоможно использовать сторонние сервисы, например https://v4.ifconfig.co/.
```{r}
```
